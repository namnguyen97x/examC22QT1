<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·∫Øc nghi·ªám M·∫°ng M√°y T√≠nh</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <div id="main-content" style="display: none;">
        <div class="container" style="padding-top:0; margin-top:0; min-height:unset;">
            <div id="home-screen" class="home-screen">
                <h1 class="main-title">üåê √în t·∫≠p M·∫°ng M√°y T√≠nh</h1>
                <div class="mode-select">
                    <button class="mode-btn" id="essay-btn">
                        <span class="mode-icon">üìù</span>
                        <span class="mode-title">T·ª± lu·∫≠n</span>
                        <span class="mode-desc">(T·ª± lu·∫≠n, √¥n t·∫≠p & l√†m b√†i)</span>
                    </button>
                    <button class="mode-btn active" id="quiz-btn">
                        <span class="mode-icon">üßë‚Äçüíª</span>
                        <span class="mode-title">Tr·∫Øc nghi·ªám</span>
                        <span class="mode-desc">99 c√¢u h·ªèi, c√≥ ch·∫•m ƒëi·ªÉm</span>
                    </button>
                </div>
            </div>

            <header style="display:none; position:relative;">
                <h1>üåê Tr·∫Øc nghi·ªám M·∫°ng M√°y T√≠nh</h1>
                <button id="finish-btn" class="finish-btn" style="position:absolute; top:18px; right:24px; display:flex; align-items:center; gap:6px; font-size:1em;">
                    <span>üõë</span> K·∫øt th√∫c
                </button>
                <div class="progress-bar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="question-counter">
                    <span id="current-question">1</span> / <span id="total-questions">99</span>
                </div>
            </header>

            <main class="quiz-container" style="display:none">
                <div class="question-card">
                    <h2 id="question-text">ƒêang t·∫£i c√¢u h·ªèi...</h2>
                    <div class="answers" id="answers-container">
                        </div>
                    <div class="navigation">
                        <button id="prev-btn" class="nav-btn" disabled>‚¨Ö C√¢u tr∆∞·ªõc</button>
                        <button id="next-btn" class="nav-btn">C√¢u ti·∫øp ‚û°</button>
                    </div>
                </div>
            </main>

            <div class="score-container" id="score-container" style="display: none;">
                <h2>üéâ K·∫øt qu·∫£ c·ªßa b·∫°n</h2>
                <div class="score-display">
                    <span id="score">0</span> / <span id="total">99</span>
                </div>
                <div class="percentage" id="percentage">0%</div>
                <div class="score-actions">
                    <button id="restart-btn" class="restart-btn">üîÑ L√†m l·∫°i</button>
                    <button id="review-btn" class="review-btn">üìã Xem l·∫°i</button>
                </div>
            </div>

            <div class="review-container" id="review-container" style="display: none;">
                <h2>üìã Xem l·∫°i k·∫øt qu·∫£</h2>
                <div id="review-content"></div>
                <div class="review-actions">
                    <button id="back-to-quiz" class="nav-btn">üè† V·ªÅ trang ch·ªß</button>
                    <button id="review-restart-btn" class="restart-btn">üîÑ L√†m l·∫°i</button>
                </div>
            </div>
        </div>
        <!-- V√πng hi·ªÉn th·ªã cho ph·∫ßn t·ª± lu·∫≠n -->
        <div id="essay-section" style="display:none;"></div>
    </div>

    <script src="questions.js"></script>
    <script src="script.js"></script>
    <script src="tuluan.js"></script>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            
            const studentList = [
                { msv: '2210108001', hoTen: 'L∆∞∆°ng Ng·ªçc √Ånh' },
                { msv: '2210108002', hoTen: 'L√™ H·∫£i D∆∞∆°ng' },
                { msv: '2210108003', hoTen: 'L√™ Nguy·ªÖn Ho√†ng' },
                { msv: '2210108004', hoTen: 'Ho√†ng Thanh H√πng' },
                { msv: '2210108005', hoTen: 'ƒê√†o Nh·∫≠t Huy' },
                { msv: '2210108006', hoTen: 'Tr·∫ßn Nguy·ªÖn ƒê·ª©c Linh' },
                { msv: '2210108007', hoTen: 'Hu·ª≥nh Kim Long' },
                { msv: '2210108009', hoTen: 'Tr·∫ßn Th√†nh L·ª£i' },
                { msv: '2210108010', hoTen: 'Nguy·ªÖn ƒê·ª©c Nam' },
                { msv: '2210108011', hoTen: 'Tr·∫ßn Khu·∫•t Nguy√™n' },
                { msv: '2210108012', hoTen: 'L√™ Th·ªã Ho√†ng Oanh' },
                { msv: '2210108013', hoTen: 'Nguy·ªÖn Thanh Phong' },
                { msv: '2210108016', hoTen: 'L·ªØ Cao Anh T√∫' },
                { msv: '2210108019', hoTen: 'Ph·∫°m VƒÉn Tu·∫•n' },
                { msv: '2210108021', hoTen: 'L√™ VƒÉn Tho·∫°i' },
                { msv: '2210108022', hoTen: 'Nguy·ªÖn Xu√¢n Tr∆∞·ªùng' },
                { msv: '2210108024', hoTen: 'V√µ Huy·ªÅn Vy' }
            ];

            // === H√ÄM ƒê√É ƒê∆Ø·ª¢C C·∫¨P NH·∫¨T ƒê·ªÇ S·ª¨A L·ªñI CH·ªÆ "ƒë" ===
            function normalizeString(str) {
                if (!str) return '';
                return str.toLowerCase()
                          .normalize("NFD")
                          .replace(/[\u0300-\u036f]/g, "")
                          .replace(/ƒë/g, 'd') // Th√™m d√≤ng n√†y ƒë·ªÉ chuy·ªÉn "ƒë" th√†nh "d"
                          .replace(/\s+/g, ' ')
                          .trim();
            }

            function showLoginPopup() {
                Swal.fire({
                    title: 'üîê ƒêƒÉng nh·∫≠p',
                    html: `
                        <input type="text" id="hoTen" class="swal2-input" placeholder="H·ªç v√† t√™n">
                        <input type="text" id="msv" class="swal2-input" placeholder="M√£ s·ªë sinh vi√™n">
                    `,
                    confirmButtonText: 'V√†o thi',
                    focusConfirm: false,
                    allowOutsideClick: false,
                    allowEscapeKey: false,
                    didOpen: () => {
                        // Cho ph√©p nh·∫•n Enter ƒë·ªÉ submit
                        const popup = Swal.getPopup();
                        popup.querySelectorAll('input').forEach(input => {
                            input.addEventListener('keydown', function(e) {
                                if (e.key === 'Enter') {
                                    e.preventDefault();
                                    Swal.clickConfirm();
                                }
                            });
                        });
                    },
                    preConfirm: () => {
                        const hoTen = Swal.getPopup().querySelector('#hoTen').value;
                        const msv = Swal.getPopup().querySelector('#msv').value.trim();

                        if (!msv || !hoTen) {
                            Swal.showValidationMessage('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
                            return false;
                        }

                        const student = studentList.find(s => s.msv === msv);

                        if (!student) {
                            Swal.showValidationMessage('M√£ s·ªë sinh vi√™n kh√¥ng t·ªìn t·∫°i!');
                            return false;
                        }

                        const normalizedInputName = normalizeString(hoTen);
                        const normalizedStudentName = normalizeString(student.hoTen);

                        if (normalizedInputName !== normalizedStudentName) {
                            Swal.showValidationMessage('H·ªç t√™n kh√¥ng kh·ªõp v·ªõi M√£ s·ªë sinh vi√™n!');
                            return false;
                        }

                        return { msv: msv, hoTen: student.hoTen };
                    }
                }).then((result) => {
                    if (result.isConfirmed) {
                        document.getElementById('main-content').style.display = 'block';
                        
                        Swal.fire({
                           title: `Ch√†o m·ª´ng ${result.value.hoTen}!`,
                           text: 'Ch√∫c b·∫°n l√†m b√†i t·ªët!',
                           icon: 'success',
                           timer: 1500,
                           showConfirmButton: false
                        });
                    }
                });
            }
            showLoginPopup();
        });
    </script>
</body>
</html>
